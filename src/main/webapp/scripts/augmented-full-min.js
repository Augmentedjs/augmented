/*
 Apache-2.0
*/
(function(t,b){"function"===typeof define&&define.amd?define(["backbone","exports"],function(n,G){t.Augmented=b(t,G,n)}):"undefined"!==typeof exports?(require("backbone"),b(t,exports,Backbone)):t.Augmented=b(t,{},t.Backbone)})(this,function(t,b,n){var G=t.Augmented;b.VERSION="0.1.0";b.codename="Adam Jensen";b.releasename="Tai Yong";b.noConflict=function(){t.Augmented=G;n.noConflict();return this};b._=n._;b.$=n.$;b.Configuration={LoggerLevel:"debug",MessageBundle:"Messages",AsynchronousQueueTimeout:2E3,
ApplicationInitProcessTimeout:1E3};b.extend=n.Model.extend;b.sync=n.sync;b.isFunction=function(a){return"[object Function]"==Object.prototype.toString.call(a)};b.result=function(a,e){if(null!==a){var h=a[e];return b.isFunction(h)?h.call(a):h}};Array.prototype.includes||(Array.prototype.includes=function(a,e){var h=Object(this),b=parseInt(h.length)||0;if(0===b)return!1;var d=parseInt(e)||0;0<=d||(d=b+d,0>d&&(d=0));for(var f;d<b;){f=h[d];if(a===f||a!==a&&f!==f)return!0;d++}return!1});Array.prototype.has=
function(a){return-1!==this.indexOf(a)};b.Utility={};var r=b.Utility.TransformerType={string:0,integer:1,number:2,"boolean":3,array:4,object:5,"null":6};b.Utility.Transformer={type:r,transform:function(a,e){var h=null;switch(e){case r.string:h="object"===typeof a?JSON.stringify(a):String(a);break;case r.integer:h=parseInt(a);break;case r.number:h=Number(a);break;case r["boolean"]:h=Boolean(a);break;case r.array:Array.isArray(a)?h=a:(h=[],h[0]=a);break;case r.object:"object"!==typeof a?(h={},h[a]=
a):h=a}return h},isType:function(a){if(null===a)return r["null"];if("string"===typeof a)return r.string;if("number"===typeof a)return r.number;if("boolean"===typeof a)return r["boolean"];if(Array.isArray(a))return r.array;if("object"===typeof a)return r.object}};b.Utility.isString=function(a){return"string"===typeof a||!!a&&"object"===typeof a&&"[object String]"===Object.prototype.toString.call(a)};b.Utility.extend=function(){for(var a=1;a<arguments.length;a++)for(var e in arguments[a])arguments[a].hasOwnProperty(e)&&
(arguments[0][e]=arguments[a][e]);return arguments[0]};var H=XMLHttpRequest;b.Utility.extend(H,{done:function(){},fail:function(){},always:function(){},then:function(){}});var L=function(){this.responseType="text";this.responseText="";this.async=!0;this.status=200;this.header={};this.timeout=70;this.open=function(a,e,h,b,d){this.url=e;this.async=h;this.user=b;this.method=a};this.send=function(){this.onload()};this.setRequestHeader=function(a,e){this.header.header=e};this.done=function(){};this.fail=
function(){};this.always=function(){};this.then=function(){};this.options={}};b.Ajax={};b.Ajax.Configuration={url:"localhost",contentType:"text/plain",dataType:"text",async:!0};var d=b.ajax=b.Ajax.ajax=function(a){C.debug("Ajax object: "+JSON.stringify(a));var e=null;if(a&&a.url){var h=a.method?a.method:"GET",b=a.cache?a.cache:!0,e=a.mock?new L:new H;a.timeout&&(e.timeout=a.timeout);var d=void 0!==a.async?a.async:!0;a.withCredentials&&(e.withCredentials=a.withCredentials,C.warn("Augmented.ajax: Sync Not supported for all browsers in CORS mode!"),
d=!0);d&&a.dataType&&(e.responseType=a.dataType?a.dataType:"text");e.open(h,encodeURI(a.url),d,void 0!==a.user?a.user:"",void 0!==a.password?a.password:"");e.setRequestHeader("Content-Type",a.contentType?a.contentType:"text/plain");b||e.setRequestHeader("Cache-Control","no-cache");e.onload=function(){199<e.status&&300>e.status?a.success&&a.success(e.responseText,e.status):399<e.status&&600>e.status&&a.failure&&a.failure(e.responseText,e.status);a.complete&&a.complete(e.responseText,e.status);return e};
a.beforeSend&&a.beforeSend(e);e.send()}this.done=function(){};this.fail=function(){};this.always=function(){};this.then=function(){};return this};n.ajax=d;b.Logger={};var p=b.Logger.Type={console:"console",rest:"rest"},f=b.Logger.Level={info:"info",debug:"debug",error:"error",warn:"warn"},x=function(a){this.TIME_SEPERATOR=":";this.DATE_SEPERATOR="-";this.OPEN_GROUP=" [ ";this.CLOSE_GROUP=" ] ";this.label=f;this.loggerLevel=a?a:f.info;this.getLogTime=function(){var a=new Date;return a.getFullYear()+
this.DATE_SEPERATOR+(a.getMonth()+1)+this.DATE_SEPERATOR+a.getDate()+" "+a.getHours()+this.TIME_SEPERATOR+a.getMinutes()+this.TIME_SEPERATOR+a.getSeconds()+this.TIME_SEPERATOR+a.getMilliseconds()};this.log=function(a,h){a&&(h||(h=f.info),this.loggerLevel===f.debug&&h===f.debug?this.logMe(this.getLogTime()+this.OPEN_GROUP+f.debug+this.CLOSE_GROUP+a,h):h===f.error?this.logMe(this.getLogTime()+this.OPEN_GROUP+f.error+this.CLOSE_GROUP+a,h):h===f.warn?this.logMe(this.getLogTime()+this.OPEN_GROUP+f.warn+
this.CLOSE_GROUP+a,h):this.loggerLevel!==f.debug&&this.loggerLevel!==f.info||this.logMe(this.getLogTime()+this.OPEN_GROUP+f.info+this.CLOSE_GROUP+a,h))};this.info=function(a){this.log(a,f.info)};this.error=function(a){this.log(a,f.error)};this.debug=function(a){this.log(a,f.debug)};this.warn=function(a){this.log(a,f.warn)}},z=function(){x.apply(this,arguments)};z.prototype=Object.create(x.prototype);z.prototype.constructor=z;z.prototype.logMe=function(a,e){e===f.info?console.info(a):e===f.error?console.error(a):
e===f.debug?console.log(a):e===f.warn?console.warn(a):console.log(a)};var A=function(){x.apply(this,arguments)};A.prototype=Object.create(x.prototype);A.prototype.constructor=A;A.prototype.setURI=function(a){this.uri=a};A.prototype.logMe=function(a){d({url:this.uri,method:"POST",contentType:"text/plain",dataType:"text",async:!0,data:a,success:function(a,h){this.success()},failure:function(a,h){this.failure()}})};b.Logger.LoggerFactory={getLogger:function(a,e){if(a===p.console)return new z(e);if(a===
p.rest)return new A(e)}};var C=b.Logger.LoggerFactory.getLogger(p.console,b.Configuration.LoggerLevel);b.Utility.wrap=function(a,e){return function(){return e.apply(this,[a].concat(Array.prototype.slice.call(arguments)))}};b.Utility.Array=function(a){this.has=function(e){return a.has(e)}};b.Utility.AugmentedMap=function(a){this.keys=[];this.data={};this.set=function(a,h){null!==a&&null!==h&&(this.data[a]||this.keys.push(a),this.data[a]=h)};this.get=function(a){return this.data[a]};this.indexOf=function(a){return this.keys.indexOf(a)};
this.remove=function(a){var h=this.indexOf(a);this.keys.splice(h,1);delete this.data[a]};this.has=function(a){return-1!==this.indexOf(a)};this.forEach=function(a){if("function"===typeof a)for(var h=this.keys.length,b=0,d,b=0;b<h;b++)d=this.keys[b],a(d,this.data[d],b)};this.key=function(a){return this.keys[a]};this.entries=function(){for(var a=this.keys.length,b=Array(a),d=0;d<a;d++)b[d]={key:this.keys[d],value:this.data[d]};return b};this.values=function(){for(var a=this.keys.length,b=Array(a),d=
0;d<a;d++)b[d]=this.data[d];return b};this.clear=function(){this.keys=[];this.data={}};this.size=function(){return this.keys.length};this.toJSON=function(){return this.data};this.toString=function(){return JSON.stringify(this.data)};this.isEmpty=function(){return 0===this.keys.length};this.marshall=function(a){if(a&&a instanceof b.Utility.AugmentedMap)a=a.toJSON();else if(!(a&&a instanceof Object&&0<Object.keys(a).length))return C.warn("Could not marshall data: "+JSON.stringify(a)),!1;for(var h=Object.keys(a),
d=0;d<h.length;d++){var f=h[d],u=a[f];C.debug("setting "+f+", "+u);this.set(f,u)}return!0};if(a)return this.marshall(a)};b.Object=function(a){this.options=b.Utility.extend({},b.result(this,"options"),a);this.initialize.apply(this,arguments)};b.Object.extend=b.extend;b.Utility.extend(b.Object.prototype,n.Events,{initialize:function(){}});b.Security={};b.Security.Client={};var R=b.Security.Principal={fullName:"",id:0,login:"",email:""},S=b.Security.Context=function(a,b){this.principal=a?a:(new a).login=
"guest";this.permissions=b?b:[];this.getPrincipal=function(){return this.principal};this.getPermissions=function(){return this.permissions};this.setPermissions=function(a){this.permissions=a};this.addPermission=function(a){this.permissions.push(a)};this.removePermission=function(a){a=this.permissions.indexOf(a);this.permissions.splice(a,1)};this.hasPermission=function(a){return-1!=this.permissions.indexOf(a)}};b.Security.ClientType={OAUTH2:0,ACL:1};var F=b.Object.extend({type:null,uri:""});b.Security.Client.OAUTH2Client=
F.extend({type:b.Security.ClientType.OAUTH2,accessToken:"",authorizationToken:"",authorize:function(a){this.authorizationToken=""},access:function(a){this.accessToken=""}});b.Security.Client.ACLClient=F.extend({type:b.Security.ClientType.ACL,authenticate:function(a,b){var h=null;d({url:this.uri,method:"GET",user:a,password:b,success:function(a,b){var e=new R({fullName:a.fullName,id:a.id,login:a.login,email:a.email});h=new S(e,a.permissions)},failure:function(a,b){throw Error("Failed to authenticate with response of - "+
b);}});return h}});b.Security.AuthenticationFactory={getSecurityClient:function(a){return a===b.Security.ClientType.OAUTH2?new b.Security.Client.OAUTH2Client:a===b.Security.ClientType.ACL?new b.Security.Client.ACLClient:null}};b.Security.Entry=function(a,b){this.permissions=a?a:[];this.isNegative=b?b:!1;this.getPermissions=function(){return this.permissions};this.setPermissions=function(a){this.permissions=a};this.addPermission=function(a){this.permissions.push(a)};this.removePermission=function(a){a=
this.permissions.indexOf(a);this.permissions.splice(a,1)};this.hasPermission=function(a){return-1!=this.permissions.indexOf(a)};this.setNegative=function(a){this.isNegative=a}};var T=function(){function a(g){return encodeURI(g).replace(/%25[0-9][0-9]/g,function(g){return"%"+g.substring(3)})}function b(g){var c="";J[g.charAt(0)]&&(c=g.charAt(0),g=g.substring(1));var E="",w="",B=!0,d=!1,e=!1;"+"===c?B=!1:"."===c?E=w=".":"/"===c?E=w="/":"#"===c?(w="#",B=!1):";"===c?(E=w=";",e=d=!0):"?"===c?(w="?",E=
"&",d=!0):"&"===c&&(E=w="&",d=!0);c=[];g=g.split(",");for(var h=[],f=0;f<g.length;f++){var m=g[f],q=null;-1!==m.indexOf(":")&&(q=m.split(":"),m=q[0],q=parseInt(q[1],10));for(var k={};n[m.charAt(m.length-1)];)k[m.charAt(m.length-1)]=!0,m=m.substring(0,m.length-1);h.push({truncate:q,name:m,suffices:k});c.push(m)}g=function(g){for(var c="",b=0,m=0;m<h.length;m++){var f=h[m],q=g(f.name);if(null===q||void 0===q||Array.isArray(q)&&0===q.length||"object"===typeof q&&0===Object.keys(q).length)b++;else if(c=
m===b?c+w:c+(E||","),Array.isArray(q)){d&&(c+=f.name+"=");for(var k=0;k<q.length;k++)0<k&&(c+=f.suffices["*"]?E||",":",",f.suffices["*"]&&d&&(c+=f.name+"=")),c+=B?encodeURIComponent(q[k]).replace(/!/g,"%21"):a(q[k])}else if("object"===typeof q){d&&!f.suffices["*"]&&(c+=f.name+"=");var k=!0,l;for(l in q)k||(c+=f.suffices["*"]?E||",":","),k=!1,c+=B?encodeURIComponent(l).replace(/!/g,"%21"):a(l),c+=f.suffices["*"]?"=":",",c+=B?encodeURIComponent(q[l]).replace(/!/g,"%21"):a(q[l])}else d&&(c+=f.name,e&&
""===q||(c+="=")),null!==f.truncate&&(q=q.substring(0,f.truncate)),c+=B?encodeURIComponent(q).replace(/!/g,"%21"):a(q)}return c};g.varNames=c;return{prefix:w,substitution:g}}function d(g){if(!(this instanceof d))return new d(g);for(var c=g.split("{"),a=[c.shift()],w=[],B=[],f=[];0<c.length;){var m=c.shift(),q=m.split("}")[0],m=m.substring(q.length+1),q=b(q);B.push(q.substitution);w.push(q.prefix);a.push(m);f=f.concat(q.substitution.varNames)}this.fill=function(g){for(var c=a[0],w=0;w<B.length;w++)c+=
(0,B[w])(g),c+=a[w+1];return c};this.varNames=f;this.template=g}function f(g,c){if(g===c)return!0;if("object"===typeof g&&"object"===typeof c){if(Array.isArray(g)!==Array.isArray(c))return!1;if(Array.isArray(g)){if(g.length!==c.length)return!1;for(var a=0;a<g.length;a++)if(!f(g[a],c[a]))return!1}else{for(a in g)if(void 0===c[a]&&void 0!==g[a])return!1;for(a in c)if(void 0===g[a]&&void 0!==c[a])return!1;for(a in g)if(!f(g[a],c[a]))return!1}return!0}return!1}function p(g){return(g=String(g).replace(/^\s+|\s+$/g,
"").match(/^([^:\/?#]+:)?(\/\/(?:[^:@]*(?::[^:@]*)?@)?(([^:\/?#]*)(?::(\d*))?))?([^?#]*)(\?[^#]*)?(#[\s\S]*)?/))?{href:g[0]||"",protocol:g[1]||"",authority:g[2]||"",host:g[3]||"",hostname:g[4]||"",port:g[5]||"",pathname:g[6]||"",search:g[7]||"",hash:g[8]||""}:null}function u(g,c){function a(g){var c=[];g.replace(/^(\.\.?(\/|$))+/,"").replace(/\/(\.(\/|$))+/g,"/").replace(/\/\.\.$/,"/../").replace(/\/?[^\/]*/g,function(g){"/.."===g?c.pop():c.push(g)});return c.join("").replace(/^\//,"/"===g.charAt(0)?
"/":"")}c=p(c||"");g=p(g||"");return c&&g?(c.protocol||g.protocol)+(c.protocol||c.authority?c.authority:g.authority)+a(c.protocol||c.authority||"/"===c.pathname.charAt(0)?c.pathname:c.pathname?(g.authority&&!g.pathname?"/":"")+g.pathname.slice(0,g.pathname.lastIndexOf("/")+1)+c.pathname:g.pathname)+(c.protocol||c.authority||c.pathname?c.search:c.search||g.search)+c.hash:null}function m(g){return g.split("#")[0]}function D(g,c){if(g&&"object"===typeof g)if(void 0===c?c=g.id:"string"===typeof g.id&&
(c=u(c,g.id),g.id=c),Array.isArray(g))for(var a=0;a<g.length;a++)D(g[a],c);else for(a in"string"===typeof g.$ref&&(g.$ref=u(c,g.$ref)),g)"enum"!==a&&D(g[a],c)}function q(g,a,b,w,B,d){Error.call(this);if(void 0===g)throw Error("No code supplied for error: "+a);this.message=a;this.params=b;this.code=g;this.dataPath=w||"";this.schemaPath=B||"";this.subErrors=d||null;g=Error(this.message);this.stack=g.stack||g.stacktrace;if(!this.stack)try{throw g;}catch(e){this.stack=e.stack||e.stacktrace}}function x(g){var a=
new k,b=g||"en";return{addFormat:function(){a.addFormat.apply(a,arguments)},language:function(a){if(!a)return b;v[a]||(a=a.split("-")[0]);return v[a]?b=a:!1},addLanguage:function(a,g){for(var c in l)g[c]&&!g[l[c]]&&(g[l[c]]=g[c]);var b=a.split("-")[0];if(v[b])for(c in v[a]=Object.create(v[b]),g)"undefined"===typeof v[b][c]&&(v[b][c]=g[c]),v[a][c]=g[c];else v[a]=g,v[b]=g;return this},freshApi:function(a){var g=x();a&&g.language(a);return g},validate:function(g,d,e,f){e=new k(a,!1,v[b],e,f);"string"===
typeof d&&(d={$ref:d});e.addSchema("",d);g=e.validateAll(g,d,null,null,"");!g&&f&&(g=e.banUnknownProperties());this.error=g;this.missing=e.missing;return this.valid=null===g},validateResult:function(){var a={};this.validate.apply(a,arguments);return a},validateMultiple:function(g,d,e,f){e=new k(a,!0,v[b],e,f);"string"===typeof d&&(d={$ref:d});e.addSchema("",d);e.validateAll(g,d,null,null,"");f&&e.banUnknownProperties();g={};g.errors=e.errors;g.missing=e.missing;g.valid=0===g.errors.length;return g},
addSchema:function(){return a.addSchema.apply(a,arguments)},getSchema:function(){return a.getSchema.apply(a,arguments)},getSchemaMap:function(){return a.getSchemaMap.apply(a,arguments)},getSchemaUris:function(){return a.getSchemaUris.apply(a,arguments)},getMissingUris:function(){return a.getMissingUris.apply(a,arguments)},dropSchemas:function(){a.dropSchemas.apply(a,arguments)},defineKeyword:function(){a.defineKeyword.apply(a,arguments)},defineError:function(a,g,c){if("string"!==typeof a||!/^[A-Z]+(_[A-Z]+)*$/.test(a))throw Error("Code name must be a string in UPPER_CASE_WITH_UNDERSCORES");
if("number"!==typeof g||0!==g%1||1E4>g)throw Error("Code number must be an integer > 10000");if("undefined"!==typeof l[a])throw Error("Error already defined: "+a+" as "+l[a]);if("undefined"!==typeof y[g])throw Error("Error code already used: "+y[g]+" as "+g);l[a]=g;y[g]=a;z[a]=z[g]=c;for(var b in v)c=v[b],c[a]&&(c[g]=c[g]||c[a])},reset:function(){a.reset();this.error=null;this.missing=[];this.valid=!0},missing:[],error:null,valid:!0,normSchema:D,resolveUrl:u,getDocumentUri:m,errorCodes:l}}var J={"+":!0,
"#":!0,".":!0,"/":!0,";":!0,"?":!0,"&":!0},n={"*":!0};d.prototype={toString:function(){return this.template},fillFromObject:function(a){return this.fill(function(c){return a[c]})}};var k=function(a,c,b,d,e){this.missing=[];this.missingMap={};this.formatValidators=a?Object.create(a.formatValidators):{};this.schemas=a?Object.create(a.schemas):{};this.collectMultiple=c;this.errors=[];this.handleError=c?this.collectError:this.returnError;d&&(this.checkRecursive=!0,this.scanned=[],this.scannedFrozen=[],
this.scannedFrozenSchemas=[],this.scannedFrozenValidationErrors=[],this.validatedSchemasKey="tv4_validation_id",this.validationErrorsKey="tv4_validation_errors_id");e&&(this.trackUnknownProperties=!0,this.knownPropertyPaths={},this.unknownPropertyPaths={});this.errorMessages=b;this.definedKeywords={};if(a)for(var f in a.definedKeywords)this.definedKeywords[f]=a.definedKeywords[f].slice(0)};k.prototype.defineKeyword=function(a,c){this.definedKeywords[a]=this.definedKeywords[a]||[];this.definedKeywords[a].push(c)};
k.prototype.createError=function(a,c,b,d,e){var f=this.errorMessages[a]||z[a];if("string"!==typeof f)return new q(a,"Unknown error code "+a+": "+JSON.stringify(c),c,b,d,e);f=f.replace(/\{([^{}]*)\}/g,function(a,g){var b=c[g];return"string"===typeof b||"number"===typeof b?b:a});return new q(a,f,c,b,d,e)};k.prototype.returnError=function(a){return a};k.prototype.collectError=function(a){a&&this.errors.push(a);return null};k.prototype.prefixErrors=function(a,c,b){for(;a<this.errors.length;a++)this.errors[a]=
this.errors[a].prefixWith(c,b);return this};k.prototype.banUnknownProperties=function(){for(var a in this.unknownPropertyPaths){var c=this.createError(l.UNKNOWN_PROPERTY,{path:a},a,"");if(c=this.handleError(c))return c}return null};k.prototype.addFormat=function(a,c){if("object"===typeof a){for(var b in a)this.addFormat(b,a[b]);return this}this.formatValidators[a]=c};k.prototype.resolveRefs=function(a,c){if(void 0!==a.$ref){c=c||{};if(c[a.$ref])return this.createError(l.CIRCULAR_REFERENCE,{urls:Object.keys(c).join(", ")},
"","");c[a.$ref]=!0;a=this.getSchema(a.$ref,c)}return a};k.prototype.getSchema=function(a,c){var b;if(void 0!==this.schemas[a])return b=this.schemas[a],this.resolveRefs(b,c);var d=a,e="";-1!==a.indexOf("#")&&(e=a.substring(a.indexOf("#")+1),d=a.substring(0,a.indexOf("#")));if("object"===typeof this.schemas[d]){b=this.schemas[d];e=decodeURIComponent(e);if(""===e)return this.resolveRefs(b,c);if("/"!==e.charAt(0))return;for(var e=e.split("/").slice(1),f=0;f<e.length;f++){var m=e[f].replace(/~1/g,"/").replace(/~0/g,
"~");if(void 0===b[m]){b=void 0;break}b=b[m]}if(void 0!==b)return this.resolveRefs(b,c)}void 0===this.missing[d]&&(this.missing.push(d),this.missing[d]=d,this.missingMap[d]=d)};k.prototype.searchSchemas=function(a,c){if(Array.isArray(a))for(var b=0;b<a.length;b++)this.searchSchemas(a[b],c);else if(a&&"object"===typeof a){if("string"===typeof a.id){var d;a:{d=a.id;if(d.substring(0,c.length)===c){var e=d.substring(c.length);if(0<d.length&&"/"===d.charAt(c.length-1)||"#"===e.charAt(0)||"?"===e.charAt(0)){d=
!0;break a}}d=!1}d&&void 0===this.schemas[a.id]&&(this.schemas[a.id]=a)}for(b in a)"enum"!==b&&("object"===typeof a[b]?this.searchSchemas(a[b],c):"$ref"===b&&(d=m(a[b]))&&void 0===this.schemas[d]&&void 0===this.missingMap[d]&&(this.missingMap[d]=d))}};k.prototype.addSchema=function(a,c){if("string"!==typeof a||"undefined"===typeof c)if("object"===typeof a&&"string"===typeof a.id)c=a,a=c.id;else return;a===m(a)+"#"&&(a=m(a));this.schemas[a]=c;delete this.missingMap[a];D(c,a);this.searchSchemas(c,a)};
k.prototype.getSchemaMap=function(){var a={},c;for(c in this.schemas)a[c]=this.schemas[c];return a};k.prototype.getSchemaUris=function(a){var c=[],b;for(b in this.schemas)a&&!a.test(b)||c.push(b);return c};k.prototype.getMissingUris=function(a){var c=[],b;for(b in this.missingMap)a&&!a.test(b)||c.push(b);return c};k.prototype.dropSchemas=function(){this.schemas={};this.reset()};k.prototype.reset=function(){this.missing=[];this.missingMap={};this.errors=[]};k.prototype.validateAll=function(a,c,b,d,
e){var f;c=this.resolveRefs(c);if(!c)return null;if(c instanceof q)return this.errors.push(c),c;var m=this.errors.length,h,k=null,l=null;if(this.checkRecursive&&a&&"object"===typeof a){f=!this.scanned.length;if(a[this.validatedSchemasKey]){var u=a[this.validatedSchemasKey].indexOf(c);if(-1!==u)return this.errors=this.errors.concat(a[this.validationErrorsKey][u]),null}if(Object.isFrozen(a)&&(h=this.scannedFrozen.indexOf(a),-1!==h&&(u=this.scannedFrozenSchemas[h].indexOf(c),-1!==u)))return this.errors=
this.errors.concat(this.scannedFrozenValidationErrors[h][u]),null;this.scanned.push(a);if(Object.isFrozen(a))-1===h&&(h=this.scannedFrozen.length,this.scannedFrozen.push(a),this.scannedFrozenSchemas.push([])),k=this.scannedFrozenSchemas[h].length,this.scannedFrozenSchemas[h][k]=c,this.scannedFrozenValidationErrors[h][k]=[];else{if(!a[this.validatedSchemasKey])try{Object.defineProperty(a,this.validatedSchemasKey,{value:[],configurable:!0}),Object.defineProperty(a,this.validationErrorsKey,{value:[],
configurable:!0})}catch(p){a[this.validatedSchemasKey]=[],a[this.validationErrorsKey]=[]}l=a[this.validatedSchemasKey].length;a[this.validatedSchemasKey][l]=c;a[this.validationErrorsKey][l]=[]}}u=this.errors.length;c=this.validateBasic(a,c,e)||this.validateNumeric(a,c,e)||this.validateString(a,c,e)||this.validateArray(a,c,e)||this.validateObject(a,c,e)||this.validateCombinations(a,c,e)||this.validateHypermedia(a,c,e)||this.validateFormat(a,c,e)||this.validateDefinedKeywords(a,c,e)||null;if(f){for(;this.scanned.length;)delete this.scanned.pop()[this.validatedSchemasKey];
this.scannedFrozen=[];this.scannedFrozenSchemas=[]}if(c||u!==this.errors.length)for(;b&&b.length||d&&d.length;)f=b&&b.length?""+b.pop():null,e=d&&d.length?""+d.pop():null,c&&(c=c.prefixWith(f,e)),this.prefixErrors(u,f,e);null!==k?this.scannedFrozenValidationErrors[h][k]=this.errors.slice(m):null!==l&&(a[this.validationErrorsKey][l]=this.errors.slice(m));return this.handleError(c)};k.prototype.validateFormat=function(a,c){if("string"!==typeof c.format||!this.formatValidators[c.format])return null;
var b=this.formatValidators[c.format].call(null,a,c);return"string"===typeof b||"number"===typeof b?this.createError(l.FORMAT_CUSTOM,{message:b}).prefixWith(null,"format"):b&&"object"===typeof b?this.createError(l.FORMAT_CUSTOM,{message:b.message||"?"},b.dataPath||null,b.schemaPath||"/format"):null};k.prototype.validateDefinedKeywords=function(a,c,b){for(var d in this.definedKeywords)if("undefined"!==typeof c[d])for(var e=this.definedKeywords[d],f=0;f<e.length;f++){var m=(0,e[f])(a,c[d],c,b);if("string"===
typeof m||"number"===typeof m)return this.createError(l.KEYWORD_CUSTOM,{key:d,message:m}).prefixWith(null,"format");if(m&&"object"===typeof m){a=m.code;if("string"===typeof a){if(!l[a])throw Error("Undefined error code (use defineError): "+a);a=l[a]}else"number"!==typeof a&&(a=l.KEYWORD_CUSTOM);c="object"===typeof m.message?m.message:{key:d,message:m.message||"?"};d=m.schemaPath||"/"+d.replace(/~/g,"~0").replace(/\//g,"~1");return this.createError(a,c,m.dataPath||null,d)}}return null};k.prototype.validateBasic=
function(a,c,b){var d;return(d=this.validateType(a,c,b))||(d=this.validateEnum(a,c,b))?d.prefixWith(null,"type"):null};k.prototype.validateType=function(a,c){if(void 0===c.type)return null;var b=typeof a;null===a?b="null":Array.isArray(a)&&(b="array");var d=c.type;"object"!==typeof d&&(d=[d]);for(var e=0;e<d.length;e++){var f=d[e];if(f===b||"integer"===f&&"number"===b&&0===a%1)return null}return this.createError(l.INVALID_TYPE,{type:b,expected:d.join("/")})};k.prototype.validateEnum=function(a,c){if(void 0===
c["enum"])return null;for(var b=0;b<c["enum"].length;b++)if(f(a,c["enum"][b]))return null;return this.createError(l.ENUM_MISMATCH,{value:"undefined"!==typeof JSON?JSON.stringify(a):a})};k.prototype.validateNumeric=function(a,c,b){return this.validateMultipleOf(a,c,b)||this.validateMinMax(a,c,b)||this.validateNaN(a,c,b)||null};var O=Math.pow(2,-51),t=1-O;k.prototype.validateMultipleOf=function(a,c){var b=c.multipleOf||c.divisibleBy;if(void 0===b)return null;if("number"===typeof a){var d=a/b%1;if(d>=
O&&d<t)return this.createError(l.NUMBER_MULTIPLE_OF,{value:a,multipleOf:b})}return null};k.prototype.validateMinMax=function(a,c){if("number"!==typeof a)return null;if(void 0!==c.minimum){if(a<c.minimum)return this.createError(l.NUMBER_MINIMUM,{value:a,minimum:c.minimum}).prefixWith(null,"minimum");if(c.exclusiveMinimum&&a===c.minimum)return this.createError(l.NUMBER_MINIMUM_EXCLUSIVE,{value:a,minimum:c.minimum}).prefixWith(null,"exclusiveMinimum")}if(void 0!==c.maximum){if(a>c.maximum)return this.createError(l.NUMBER_MAXIMUM,
{value:a,maximum:c.maximum}).prefixWith(null,"maximum");if(c.exclusiveMaximum&&a===c.maximum)return this.createError(l.NUMBER_MAXIMUM_EXCLUSIVE,{value:a,maximum:c.maximum}).prefixWith(null,"exclusiveMaximum")}return null};k.prototype.validateNaN=function(a){return"number"!==typeof a?null:!0===isNaN(a)||Infinity===a||-Infinity===a?this.createError(l.NUMBER_NOT_A_NUMBER,{value:a}).prefixWith(null,"type"):null};k.prototype.validateString=function(a,c,b){return this.validateStringLength(a,c,b)||this.validateStringPattern(a,
c,b)||null};k.prototype.validateStringLength=function(a,c){return"string"!==typeof a?null:void 0!==c.minLength&&a.length<c.minLength?this.createError(l.STRING_LENGTH_SHORT,{length:a.length,minimum:c.minLength}).prefixWith(null,"minLength"):void 0!==c.maxLength&&a.length>c.maxLength?this.createError(l.STRING_LENGTH_LONG,{length:a.length,maximum:c.maxLength}).prefixWith(null,"maxLength"):null};k.prototype.validateStringPattern=function(a,c){return"string"!==typeof a||void 0===c.pattern?null:(new RegExp(c.pattern)).test(a)?
null:this.createError(l.STRING_PATTERN,{pattern:c.pattern}).prefixWith(null,"pattern")};k.prototype.validateArray=function(a,c,b){return Array.isArray(a)?this.validateArrayLength(a,c,b)||this.validateArrayUniqueItems(a,c,b)||this.validateArrayItems(a,c,b)||null:null};k.prototype.validateArrayLength=function(a,c){var b;return void 0!==c.minItems&&a.length<c.minItems&&(b=this.createError(l.ARRAY_LENGTH_SHORT,{length:a.length,minimum:c.minItems}).prefixWith(null,"minItems"),this.handleError(b))||void 0!==
c.maxItems&&a.length>c.maxItems&&(b=this.createError(l.ARRAY_LENGTH_LONG,{length:a.length,maximum:c.maxItems}).prefixWith(null,"maxItems"),this.handleError(b))?b:null};k.prototype.validateArrayUniqueItems=function(a,c){if(c.uniqueItems)for(var b=0;b<a.length;b++)for(var d=b+1;d<a.length;d++)if(f(a[b],a[d])){var e=this.createError(l.ARRAY_UNIQUE,{match1:b,match2:d}).prefixWith(null,"uniqueItems");if(this.handleError(e))return e}return null};k.prototype.validateArrayItems=function(a,c,b){if(void 0===
c.items)return null;var d,e;if(Array.isArray(c.items))for(e=0;e<a.length;e++)if(e<c.items.length){if(d=this.validateAll(a[e],c.items[e],[e],["items",e],b+"/"+e))return d}else{if(void 0!==c.additionalItems)if("boolean"===typeof c.additionalItems){if(!c.additionalItems&&(d=this.createError(l.ARRAY_ADDITIONAL_ITEMS,{}).prefixWith(""+e,"additionalItems"),this.handleError(d)))return d}else if(d=this.validateAll(a[e],c.additionalItems,[e],["additionalItems"],b+"/"+e))return d}else for(e=0;e<a.length;e++)if(d=
this.validateAll(a[e],c.items,[e],["items"],b+"/"+e))return d;return null};k.prototype.validateObject=function(a,c,b){return"object"!==typeof a||null===a||Array.isArray(a)?null:this.validateObjectMinMaxProperties(a,c,b)||this.validateObjectRequiredProperties(a,c,b)||this.validateObjectProperties(a,c,b)||this.validateObjectDependencies(a,c,b)||null};k.prototype.validateObjectMinMaxProperties=function(a,c){var b=Object.keys(a),d;return void 0!==c.minProperties&&b.length<c.minProperties&&(d=this.createError(l.OBJECT_PROPERTIES_MINIMUM,
{propertyCount:b.length,minimum:c.minProperties}).prefixWith(null,"minProperties"),this.handleError(d))||void 0!==c.maxProperties&&b.length>c.maxProperties&&(d=this.createError(l.OBJECT_PROPERTIES_MAXIMUM,{propertyCount:b.length,maximum:c.maxProperties}).prefixWith(null,"maxProperties"),this.handleError(d))?d:null};k.prototype.validateObjectRequiredProperties=function(a,c){if(void 0!==c.required)for(var b=0;b<c.required.length;b++){var d=c.required[b];if(void 0===a[d]&&(d=this.createError(l.OBJECT_REQUIRED,
{key:d}).prefixWith(null,""+b).prefixWith(null,"required"),this.handleError(d)))return d}return null};k.prototype.validateObjectProperties=function(a,c,b){var d,e;for(e in a){var f=b+"/"+e.replace(/~/g,"~0").replace(/\//g,"~1"),m=!1;if(void 0!==c.properties&&void 0!==c.properties[e]&&(m=!0,d=this.validateAll(a[e],c.properties[e],[e],["properties",e],f)))return d;if(void 0!==c.patternProperties)for(var h in c.patternProperties)if((new RegExp(h)).test(e)&&(m=!0,d=this.validateAll(a[e],c.patternProperties[h],
[e],["patternProperties",h],f)))return d;if(m)this.trackUnknownProperties&&(this.knownPropertyPaths[f]=!0,delete this.unknownPropertyPaths[f]);else if(void 0!==c.additionalProperties)if(this.trackUnknownProperties&&(this.knownPropertyPaths[f]=!0,delete this.unknownPropertyPaths[f]),"boolean"===typeof c.additionalProperties){if(!c.additionalProperties&&(d=this.createError(l.OBJECT_ADDITIONAL_PROPERTIES,{}).prefixWith(e,"additionalProperties"),this.handleError(d)))return d}else{if(d=this.validateAll(a[e],
c.additionalProperties,[e],["additionalProperties"],f))return d}else this.trackUnknownProperties&&!this.knownPropertyPaths[f]&&(this.unknownPropertyPaths[f]=!0)}return null};k.prototype.validateObjectDependencies=function(a,c,b){var d;if(void 0!==c.dependencies)for(var e in c.dependencies)if(void 0!==a[e]){var f=c.dependencies[e];if("string"===typeof f){if(void 0===a[f]&&(d=this.createError(l.OBJECT_DEPENDENCY_KEY,{key:e,missing:f}).prefixWith(null,e).prefixWith(null,"dependencies"),this.handleError(d)))return d}else if(Array.isArray(f))for(var m=
0;m<f.length;m++){if(d=f[m],void 0===a[d]&&(d=this.createError(l.OBJECT_DEPENDENCY_KEY,{key:e,missing:d}).prefixWith(null,""+m).prefixWith(null,e).prefixWith(null,"dependencies"),this.handleError(d)))return d}else if(d=this.validateAll(a,f,[],["dependencies",e],b))return d}return null};k.prototype.validateCombinations=function(a,c,b){return this.validateAllOf(a,c,b)||this.validateAnyOf(a,c,b)||this.validateOneOf(a,c,b)||this.validateNot(a,c,b)||null};k.prototype.validateAllOf=function(a,c,b){if(void 0===
c.allOf)return null;for(var d,e=0;e<c.allOf.length;e++)if(d=this.validateAll(a,c.allOf[e],[],["allOf",e],b))return d;return null};k.prototype.validateAnyOf=function(a,c,b){if(void 0===c.anyOf)return null;var d=[],e=this.errors.length,f,m;this.trackUnknownProperties&&(f=this.unknownPropertyPaths,m=this.knownPropertyPaths);for(var h=!0,q=0;q<c.anyOf.length;q++){this.trackUnknownProperties&&(this.unknownPropertyPaths={},this.knownPropertyPaths={});var k=this.errors.length,u=this.validateAll(a,c.anyOf[q],
[],["anyOf",q],b);if(null===u&&k===this.errors.length){this.errors=this.errors.slice(0,e);if(this.trackUnknownProperties){for(var p in this.knownPropertyPaths)m[p]=!0,delete f[p];for(var D in this.unknownPropertyPaths)m[D]||(f[D]=!0);h=!1;continue}return null}u&&d.push(u.prefixWith(null,""+q).prefixWith(null,"anyOf"))}this.trackUnknownProperties&&(this.unknownPropertyPaths=f,this.knownPropertyPaths=m);if(h)return d=d.concat(this.errors.slice(e)),this.errors=this.errors.slice(0,e),this.createError(l.ANY_OF_MISSING,
{},"","/anyOf",d)};k.prototype.validateOneOf=function(a,c,b){if(void 0===c.oneOf)return null;var d=null,e=[],f=this.errors.length,m,h;this.trackUnknownProperties&&(m=this.unknownPropertyPaths,h=this.knownPropertyPaths);for(var q=0;q<c.oneOf.length;q++){this.trackUnknownProperties&&(this.unknownPropertyPaths={},this.knownPropertyPaths={});var k=this.errors.length,u=this.validateAll(a,c.oneOf[q],[],["oneOf",q],b);if(null===u&&k===this.errors.length){if(null===d)d=q;else return this.errors=this.errors.slice(0,
f),this.createError(l.ONE_OF_MULTIPLE,{index1:d,index2:q},"","/oneOf");if(this.trackUnknownProperties){for(var p in this.knownPropertyPaths)h[p]=!0,delete m[p];for(var D in this.unknownPropertyPaths)h[D]||(m[D]=!0)}}else u&&e.push(u)}this.trackUnknownProperties&&(this.unknownPropertyPaths=m,this.knownPropertyPaths=h);if(null===d)return e=e.concat(this.errors.slice(f)),this.errors=this.errors.slice(0,f),this.createError(l.ONE_OF_MISSING,{},"","/oneOf",e);this.errors=this.errors.slice(0,f);return null};
k.prototype.validateNot=function(a,c,b){if(void 0===c.not)return null;var d=this.errors.length,e,f;this.trackUnknownProperties&&(e=this.unknownPropertyPaths,f=this.knownPropertyPaths,this.unknownPropertyPaths={},this.knownPropertyPaths={});a=this.validateAll(a,c.not,null,null,b);c=this.errors.slice(d);this.errors=this.errors.slice(0,d);this.trackUnknownProperties&&(this.unknownPropertyPaths=e,this.knownPropertyPaths=f);return null===a&&0===c.length?this.createError(l.NOT_PASSED,{},"","/not"):null};
k.prototype.validateHypermedia=function(a,c,b){if(!c.links)return null;for(var e,f=0;f<c.links.length;f++)if(e=c.links[f],"describedby"===e.rel){e=new d(e.href);for(var m=!0,q=0;q<e.varNames.length;q++)if(!(e.varNames[q]in a)){m=!1;break}if(m&&(e={$ref:e.fillFromObject(a)},e=this.validateAll(a,e,[],["links",f],b)))return e}};var l={INVALID_TYPE:0,ENUM_MISMATCH:1,ANY_OF_MISSING:10,ONE_OF_MISSING:11,ONE_OF_MULTIPLE:12,NOT_PASSED:13,NUMBER_MULTIPLE_OF:100,NUMBER_MINIMUM:101,NUMBER_MINIMUM_EXCLUSIVE:102,
NUMBER_MAXIMUM:103,NUMBER_MAXIMUM_EXCLUSIVE:104,NUMBER_NOT_A_NUMBER:105,STRING_LENGTH_SHORT:200,STRING_LENGTH_LONG:201,STRING_PATTERN:202,OBJECT_PROPERTIES_MINIMUM:300,OBJECT_PROPERTIES_MAXIMUM:301,OBJECT_REQUIRED:302,OBJECT_ADDITIONAL_PROPERTIES:303,OBJECT_DEPENDENCY_KEY:304,ARRAY_LENGTH_SHORT:400,ARRAY_LENGTH_LONG:401,ARRAY_UNIQUE:402,ARRAY_ADDITIONAL_ITEMS:403,FORMAT_CUSTOM:500,KEYWORD_CUSTOM:501,CIRCULAR_REFERENCE:600,UNKNOWN_PROPERTY:1E3},y={},r;for(r in l)y[l[r]]=r;var z={INVALID_TYPE:"Invalid type: {type} (expected {expected})",
ENUM_MISMATCH:"No enum match for: {value}",ANY_OF_MISSING:'Data does not match any schemas from "anyOf"',ONE_OF_MISSING:'Data does not match any schemas from "oneOf"',ONE_OF_MULTIPLE:'Data is valid against more than one schema from "oneOf": indices {index1} and {index2}',NOT_PASSED:'Data matches schema from "not"',NUMBER_MULTIPLE_OF:"Value {value} is not a multiple of {multipleOf}",NUMBER_MINIMUM:"Value {value} is less than minimum {minimum}",NUMBER_MINIMUM_EXCLUSIVE:"Value {value} is equal to exclusive minimum {minimum}",
NUMBER_MAXIMUM:"Value {value} is greater than maximum {maximum}",NUMBER_MAXIMUM_EXCLUSIVE:"Value {value} is equal to exclusive maximum {maximum}",NUMBER_NOT_A_NUMBER:"Value {value} is not a valid number",STRING_LENGTH_SHORT:"String is too short ({length} chars), minimum {minimum}",STRING_LENGTH_LONG:"String is too long ({length} chars), maximum {maximum}",STRING_PATTERN:"String does not match pattern: {pattern}",OBJECT_PROPERTIES_MINIMUM:"Too few properties defined ({propertyCount}), minimum {minimum}",
OBJECT_PROPERTIES_MAXIMUM:"Too many properties defined ({propertyCount}), maximum {maximum}",OBJECT_REQUIRED:"Missing required property: {key}",OBJECT_ADDITIONAL_PROPERTIES:"Additional properties not allowed",OBJECT_DEPENDENCY_KEY:"Dependency failed - key must exist: {missing} (due to key: {key})",ARRAY_LENGTH_SHORT:"Array is too short ({length}), minimum {minimum}",ARRAY_LENGTH_LONG:"Array is too long ({length}), maximum {maximum}",ARRAY_UNIQUE:"Array items are not unique (indices {match1} and {match2})",
ARRAY_ADDITIONAL_ITEMS:"Additional items not allowed",FORMAT_CUSTOM:"Format validation failed ({message})",KEYWORD_CUSTOM:"Keyword failed: {key} ({message})",CIRCULAR_REFERENCE:"Circular $refs: {urls}",UNKNOWN_PROPERTY:"Unknown property (not in schema)"};q.prototype=Object.create(Error.prototype);q.prototype.constructor=q;q.prototype.name="ValidationError";q.prototype.prefixWith=function(a,c){null!==a&&(a=a.replace(/~/g,"~0").replace(/\//g,"~1"),this.dataPath="/"+a+this.dataPath);null!==c&&(c=c.replace(/~/g,
"~0").replace(/\//g,"~1"),this.schemaPath="/"+c+this.schemaPath);if(null!==this.subErrors)for(var b=0;b<this.subErrors.length;b++)this.subErrors[b].prefixWith(a,c);return this};var v={};r=x();r.addLanguage("en-us",z);return r.tv4=r},K=K?K:new function(){function a(a,b){d({url:a,async:!1,cache:b.cache,contentType:"text/plain;charset="+b.encoding,dataType:"text",success:function(a,d){e(a,b.mode)}})}function e(a,b){for(var d="",e=a.split(/\n/),r=/(\{\d+\})/g,J=/\{(\d+)\}/g,z=/(\\u.{4})/ig,k=0;k<e.length;k++)if(e[k]=
e[k].replace(/^\s\s*/,"").replace(/\s\s*$/,""),0<e[k].length&&"#"!=e[k].match("^#")){var n=e[k].split("=");if(0<n.length){for(var t=unescape(n[0]).replace(/^\s\s*/,"").replace(/\s\s*$/,""),l=1==n.length?"":n[1];"\\"==l.match(/\\$/);)l=l.substring(0,l.length-1),l+=e[++k].replace(/\s\s*$/,"");for(var y=2;y<n.length;y++)l+="="+n[y];l=l.replace(/^\s\s*/,"").replace(/\s\s*$/,"");if("map"==b||"both"==b){if(n=l.match(z))for(y=0;y<n.length;y++)l=l.replace(n[y],p(n[y]));x.map[t]=l}if("vars"==b||"both"==b)if(l=
l.replace(/"/g,'\\"'),f(t),r.test(l)){for(var n=l.split(r),y=!0,A="",C=[],v=0;v<n.length;v++)!r.test(n[v])||0!==C.length&&-1!==C.indexOf(n[v])||(y||(A+=","),A+=n[v].replace(J,"v$1"),C.push(n[v]),y=!1);d+=t+"=function("+A+"){";t='"'+l.replace(J,'"+v$1+"')+'"';d+="return "+t+";};"}else d+=t+'="'+l+'";'}}eval(d)}function f(a){if(/\./.test(a)){var b="";a=a.split(/\./);for(var d=0;d<a.length;d++)0<d&&(b+="."),b+=a[d],eval("typeof "+b+' == "undefined"')&&eval(b+"={};")}}function p(a){var b=[];a=parseInt(a.substr(2),
16);0<=a&&a<Math.pow(2,16)&&b.push(a);a="";for(var d=0;d<b.length;++d)a+=String.fromCharCode(b[d]);return a}var x={map:{}};this.properties=function(d){d=b.Utility.extend({name:b.Configuration.MessageBundle,language:"",path:"",mode:"vars",cache:!1,encoding:"UTF-8",callback:null},d);if(null===d.language||""===d.language){var e=d,f=navigator.language||navigator.userLanguage,f=f.toLowerCase();3<f.length&&(f=f.substring(0,3)+f.substring(3).toUpperCase());e.language=f}null===d.language&&(d.language="");
e=(e=d.name)&&e.constructor==Array?e:[e];for(f=0;f<e.length;f++)a(d.path+e[f]+".properties",d),2<=d.language.length&&a(d.path+e[f]+"_"+d.language.substring(0,2)+".properties",d),5<=d.language.length&&a(d.path+e[f]+"_"+d.language.substring(0,5)+".properties",d);d.callback&&d.callback()};this.prop=function(a){var b=x.map[a];if(!b)return"["+a+"]";var d;2==arguments.length&&Array.isArray(arguments[1])&&(d=arguments[1]);var e;if("string"==typeof b){for(e=0;-1!=(e=b.indexOf("\\",e));)b="t"==b.charAt(e+
1)?b.substring(0,e)+"\t"+b.substring(e++ +2):"r"==b.charAt(e+1)?b.substring(0,e)+"\r"+b.substring(e++ +2):"n"==b.charAt(e+1)?b.substring(0,e)+"\n"+b.substring(e++ +2):"f"==b.charAt(e+1)?b.substring(0,e)+"\f"+b.substring(e++ +2):"\\"==b.charAt(e+1)?b.substring(0,e)+"\\"+b.substring(e++ +2):b.substring(0,e)+b.substring(e+1);var f=[],h,p;for(e=0;e<b.length;)if("'"==b.charAt(e))if(e==b.length-1)b=b.substring(0,e);else if("'"==b.charAt(e+1))b=b.substring(0,e)+b.substring(++e);else{for(h=e+2;-1!=(h=b.indexOf("'",
h));)if(h==b.length-1||"'"!=b.charAt(h+1)){b=b.substring(0,e)+b.substring(e+1,h)+b.substring(h+1);e=h-1;break}else b=b.substring(0,h)+b.substring(++h);-1==h&&(b=b.substring(0,e)+b.substring(e+1))}else if("{"==b.charAt(e))if(h=b.indexOf("}",e+1),-1==h)e++;else if(p=parseInt(b.substring(e+1,h)),!isNaN(p)&&0<=p){var k=b.substring(0,e);""!==k&&f.push(k);f.push(p);e=0;b=b.substring(h+1)}else e=h+1;else e++;""!==b&&f.push(b);b=f;x.map[a]=f}if(0===b.length)return"";if(1==b.lengh&&"string"==typeof b[0])return b[0];
k="";for(e=0;e<b.length;e++)k="string"==typeof b[e]?k+b[e]:d&&b[e]<d.length?k+d[b[e]]:!d&&b[e]+1<arguments.length?k+arguments[b[e]+1]:k+("{"+b[e]+"}");return k}};b.Utility.BundleObject={name:"",mode:"both",cache:!0};b.Utility.ResourceBundle={getBundle:function(){return K.properties.apply(this,arguments)},getString:function(){return K.prop.apply(this,arguments)}};b.Utility.MessageReader={getMessage:function(a){for(var e=b.Utility.ResourceBundle.getString.apply(this,arguments),d=a.length,f=a;0<d&&e==
"["+a+"]";)d=a.lastIndexOf("."),a=a.substring(0,d),e=b.Utility.ResourceBundle.getString.apply(this,arguments);return a?e:"["+f+"]"}};b.Utility.MessageKeyFormatter={delimiter:".",format:function(a){var b="";a&&a.level&&(b+=a.level,a.kind&&(b+=this.delimiter+a.kind,a.rule&&(b+=this.delimiter+a.rule,a.values.title&&(b+=this.delimiter+a.values.title))));return b?b:""}};b.ValidationFramework=b.ValidationFramework?b.ValidationFramework:new function(){var a;void 0===a&&(a=new T);this.supportsValidation=
function(){return null!==a};this.registerSchema=function(b,d){a.addSchema(b,d)};this.getSchema=function(b){return a.getSchema(b)};this.getSchemas=function(){return a.getSchemaMap()};this.clearSchemas=function(){a.dropSchemas()};this.validate=function(b,d){return a.validateMultiple(b,d)};this.getValidationMessages=function(){return a.error}};F=n.Model.extend({schema:null,mock:!1,validationMessages:{valid:!0},supportsValidation:function(){return null!==this.schema?!0:!1},isValid:function(){this.validate();
return this.validationMessages.valid},validate:function(){this.supportsValidation()&&b.ValidationFramework.supportsValidation()?this.validationMessages=b.ValidationFramework.validate(this.toJSON(),this.schema):this.validationMessages.valid=!0;return this.validationMessages},crossOrigin:!1,sync:function(a,d,f){f||(f={});!0===this.crossOrigin&&(f.crossDomain=!0);f.xhrFields||(f.xhrFields={withCredentials:!0});this.mock&&(f.mock=this.mock);return b.sync(a,d,f)}});b.Utility.extend(F,b.Object);var M=n.Collection.extend({schema:null,
mock:!1,validationMessages:{valid:!0},supportsValidation:function(){return null!==this.schema?!0:!1},isValid:function(){this.validate();return this.validationMessages.valid},validate:function(){this.supportsValidation()&&b.ValidationFramework.supportsValidation()?this.validationMessages=b.ValidationFramework.validate(this.toJSON(),this.schema):this.validationMessages.valid=!0;return this.validationMessages},crossOrigin:!1,sync:function(a,d,f){f||(f={});!0===this.crossOrigin&&(f.crossDomain=!0);f.xhrFields||
(f.xhrFields={withCredentials:!0});this.mock&&(f.mock=this.mock);return b.sync(a,d,f)}});b.Utility.extend(M,b.Object);var N=b.PaginatedCollection=M.extend({paginationConfiguration:{currentPageParam:"page",pageSizeParam:"per_page"},pageSize:20,currentPage:1,totalPages:1,setPageSize:function(a){a&&(this.pageSize=a);this.refresh()},setCurrentPage:function(a){a||(a=1);this.currentPage=a;this.refresh()},setPaginationConfiguration:function(a){this.paginationConfiguration=a},fetch:function(a){a=a?a:{};var d=
this.paginationConfiguration,f={};f[d.currentPageParam]=this.currentPage;f[d.pageSizeParam]=this.pageSize;a.data=f;return b.Collection.prototype.fetch.call(this,a)},nextPage:function(){this.currentPage<this.totalPages&&(this.currentPage+=1,this.refresh())},previousPage:function(){0<this.currentPage&&(--this.currentPage,this.refresh())},goToPage:function(a){a&&a<this.totalPages&&0<a&&(this.currentPage=a,this.refresh())},firstPage:function(){this.currentPage=1;this.refresh()},lastPage:function(){this.currentPage=
this.totalPages;this.refresh()},refresh:function(){this.fetch()}}),I={github:"github",solr:"solr",database:"database"};b.PaginationFactory={type:I,getPaginatedCollection:function(a,b){var d=b?b:{},f=null;a||(a=I.github);a===I.github?(f=new N(d),f.setPaginationConfiguration({currentPageParam:"page",pageSizeParam:"per_page"})):a===I.solr?(f=new N(d),f.setPaginationConfiguration({currentPageParam:"start",pageSizeParam:"rows"})):a===I.database&&(f=new N(d),f.setPaginationConfiguration({currentPageParam:"offset",
pageSizeParam:"limit"}));return f}};var P=n.View.extend({init:function(a){},initialize:function(a){this.init(a);this.render=b.Utility.wrap(this.render,function(a){this.beforeRender();a();this.afterRender();return this})},beforeRender:function(){},render:function(){return this},afterRender:function(){},name:"",setName:function(a){this.name=a},getName:function(){return this.name},permissions:{include:[],exclude:[]},addPermission:function(a,b){b||(b=!1);null===a||Array.isArray(a)||(b?this.permissions.exclude:
this.permissions.include).push(a)},removePermission:function(a,b){b||(b=!1);if(null!==a&&!Array.isArray(a)){var d=b?this.permissions.exclude:this.permissions.include;d.splice(d.indexOf(a),1)}},setPermissions:function(a,b){b||(b=!1);null!==a&&Array.isArray(a)&&(b?this.permissions.exclude=a:this.permissions.include=a)},getPermissions:function(){return this.permissions},clearPermissions:function(){this.permissions={include:[],exclude:[]}},matchesPermission:function(a,b){b||(b=!1);return-1!==(b?this.permissions.exclude:
this.permissions.include).indexOf(a)},canDisplay:function(){return!0}});b.Utility.extend(P,b.Object);b.Model=F;b.Collection=M;b.View=P;b.history=n.history;b.History=n.History;b.Router=n.Router;var U=function(a){this.isPersisted=a;this.myStore=null;this.isSupported=function(){return"undefined"!==typeof Storage};this.isSupported()?(C.debug("localStorage exists"),this.myStore=this.isPersisted?localStorage:sessionStorage):C.debug("No localStorage.");this.getItem=function(a){return(a=this.myStore.getItem(a))?
JSON.parse(a):null};this.setItem=function(a,b){this.myStore.setItem(a,JSON.stringify(b))};this.removeItem=function(a){this.myStore.removeItem(a)};this.clear=function(){this.myStore.clear()};this.key=function(a){return this.myStore.key(a)};this.length=function(){return this.myStore.length}},W=function(a,d){var f=V.getStorage(a);this.myNameSpacedStore=new b.Utility.AugmentedMap;this.namespace=d;this.isSupported=function(){return f&&f.isSupported()};this.isSupported()&&this.namespace&&f.setItem(this.namespace,
JSON.stringify(this.myNameSpacedStore.toJSON()));this.getItem=function(a){var b={};try{b=JSON.parse(f.getItem(this.namespace))}catch(d){return C.error("Could not parse item map from storage!"),null}this.myNameSpacedStore.clear();this.myNameSpacedStore.marshall(b);if(a=this.myNameSpacedStore.get(a)){var e;try{e=JSON.parse(a)}catch(d){e=a}return e}return null};this.setItem=function(a,p){this.myNameSpacedStore||(this.myNameSpacedStore=new b.Utility.AugmentedMap);this.myNameSpacedStore.set(a,p);f.setItem(d,
JSON.stringify(this.myNameSpacedStore.toJSON()))};this.removeItem=function(a){this.getItem(a);this.myNameSpacedStore.remove(a);f.setItem(d,JSON.stringify(this.myNameSpacedStore.toJSON()))};this.clear=function(){this.myNameSpacedStore.clear();f.setItem(d,JSON.stringify(this.myNameSpacedStore.toJSON()))};this.key=function(a){return this.myNameSpacedStore.key(a)};this.length=function(){return this.myNameSpacedStore.size()}},V=b.LocalStorageFactory={getStorage:function(a,b){var d=null;return(d=b?new W(a,
b):new U(a))&&d.isSupported()?d:null}};b.Utility.Stack=function(){this.stack=[];this.empty=function(){return 0===this.stack.length};this.peek=function(){return this.stack[0]};this.pop=function(){return this.stack.pop()};this.push=function(a){this.stack.push(a)};this.search=function(a){return this.stack.indexOf(a)};this.size=function(){return this.stack.length};this.clear=function(){this.stack.splice(0,this.stack.length)};this.toArray=function(){return this.stack}};b.Utility.AsynchronousQueue=function(a){var d=
a?a:b.Configuration.AsynchronousQueueTimeout;this.queue={};this.add=function(){var a=arguments;if(0>=a.length)return!1;b.Utility.extend(this.queue,a)};this.clear=function(){0<this.queue.length&&this.queue.splice(0,this.queue.length)};this.process=function(){arguments&&b.Utility.extend(this.queue,arguments);var a=this.queue;if(0>=a.length)return!1;(function Q(b){if(b>=a.length||"function"!==typeof a[b])return!1;window.setTimeout(function(){a[b]();Q(b+1)},d)})(0);return!0};this.getTimeout=function(){return d};
this.getQueue=function(){return this.queue}};F=b.Application=function(a){var d;this.started=!1;d?d.clear():d=new b.Utility.AugmentedMap;a?d.set("name",a):d.set("name","untitled");this.initialize=function(){};this.beforeInitialize=function(){};this.afterInitialize=function(){};this.getName=function(){return this.getMetadataItem("name")};this.setName=function(a){return this.setMetadataItem("name",a)};this.getMetadata=function(){return d};this.setMetadataItem=function(a,b){d.set(a,b)};this.getMetadataItem=
function(a){return d.get(a)};this.start=function(){(this.started=(new b.Utility.AsynchronousQueue(b.Configuration.ApplicationInitProcessTimeout)).process(this.beforeInitialize(),this.initialize(),this.afterInitialize(),function(){b.history.started||b.history.start()}))||this.stop()};this.stop=function(){b.history.started&&b.history.stop();this.started=!1}};b.Application.prototype.constructor=F;return b});(function(t){"object"===typeof exports?module.exports=t(require("underscore","augmented")):"function"===typeof define&&define.amd?define(["underscore","augmented"],t):window.Augmented.Presentation=t(window._,window.Augmented)})(function(t,b){b.Presentation={};b.Presentation.VERSION=b.VERSION;b.Utility.extend(b.View,{getFormData:function(b){b=function(b){for(var d=[],x=0,x=0;x<b.length;x++){var n=b[x],r={};r.name=n.name;r.value=n.value;r.type=n.type;"checkbox"===n.type&&(r.value=n.checked?"on":"off");
d.push(r)}return d}(document.querySelectorAll(b+" > input"));return t(b).reduce(function(b,d){switch(d.type){case "number":""!==d.value&&(b[d.name]=parseFloat(d.value));break;case "checkbox":b[d.name]="on"===d.value?!0:!1;break;default:b[d.name]=d.value}return b},{})}});var n=b.View.prototype.delegateEvents,G=b.View.prototype.undelegateEvents;b.Presentation.Mediator=b.View.extend({defaultChannel:"augmentedChannel",channels:{},observeColleague:function(d,p,f){d instanceof b.Presentation.Colleague&&
(f||(f=this.defaultChannel),this.subscribe(f,p,d,!1))},dismissColleague:function(d,p){d instanceof b.Presentation.Colleague&&(p||(p=this.defaultChannel),this.unsubscribe(p,callback,d))},subscribe:function(b,p,f,n){this.channels[b]||(this.channels[b]=[]);this.channels[b].push({fn:p,context:f||this,once:n})},publish:function(b){if(this.channels[b])for(var p=[].slice.call(arguments,1),f,n=0;n<this.channels[b].length;n++)f=this.channels[b][n],f.fn.apply(f.context,p),f.once&&(this.unsubscribe(b,f.fn,f.context),
n--)},unsubscribe:function(b,p,f){if(this.channels[b])for(var n=0;n<this.channels[b].length;n++)p=this.channels[b][n],p.fn===fn&&p.context===f&&(this.channels[b].splice(n,1),n--)},subscribeOnce:function(b,p,f){this.subscribe(b,p,f,!0)},getColleagues:function(b){return this.getChannel(b).context},getChannels:function(){return this.channels},getChannel:function(b){b||(b=this.defaultChannel);return this.channels[b]},getDefaultChannel:function(){return this.channels[this.defaultChannel]}});var r=b.Presentation.Colleague=
b.View.extend({delegateEvents:function(){n.apply(this,arguments);this.setSubscriptions()},undelegateEvents:function(){G.apply(this,arguments);this.unsetSubscriptions()},subscriptions:{},getSubscriptions:function(){return this.subscriptions},setSubscriptions:function(d){d&&b.Utility.extend(this.subscriptions||{},d);if((d=d||this.subscriptions)&&0!==d.length){this.unsetSubscriptions(d);var p=0;for(p;p<d.length;p++){var f=d[p],n=!1;f.$once&&(f=f.$once,n=!0);"string"===typeof f&&(f=this[f]);this.subscribe(f.channel,
f,this,n)}}},unsetSubscriptions:function(b){if((b=b||this.subscriptions)&&0!==b.length){var p=0;for(p;p<b.length;p++){var f=b[p];f.$once&&(f=f.$once);"string"==typeof f&&(f=this[f]);this.unsubscribe(f.channel,f.$once||f,this)}}}}),H=b.Presentation.Application=function(){b.Application.apply(this,arguments);this.Mediators=[];this.Stylesheets=[];this.breadcrumb=new b.Utility.Stack;this.initialize=function(){this.Stylesheets&&0<this.Stylesheets.length&&this.attachStylesheets()};this.registerMediator=
function(b){b&&this.Mediators.push(b)};this.deregisterMediator=function(b){b&&(b=this.Mediators.indexOf(b),-1!=b&&this.Mediators.splice(b,1))};this.getMediators=function(){return this.Mediators};this.registerStylesheet=function(b){b&&this.Stylesheets.push(b)};this.deregisterStylesheet=function(b){b&&this.Stylesheets.splice(this.Stylesheets.indexOf(b),1)};this.attachStylesheets=function(){var b=document.getElementsByTagName("head")[0],p=0;for(p;p<this.Stylesheets.length;p++){var f=document.createElement("link");
f.type="text/css";f.rel="stylesheet";f.href=this.Stylesheets[p];b.appendChild(f)}};this.setCurrentBreadcrumb=function(b,p){1<this.breadcrumb.size()&&this.breadcrumb.pop();this.breadcrumb.push({uri:b,name:p})};this.getCurrentBreadcrumb=function(){return this.breadcrumb.peek()};this.getBreadcrumbs=function(){return this.breadcrumb.toArray()}};H.prototype.constructor=H;var L=b.PaginatedCollection.extend({});b.Presentation.AutomaticTable=r.extend({columns:{},uri:null,data:[],collection:null,isInitalized:!1,
initialize:function(b){this.collection?this.collection.reset():this.collection=new L;b&&(b.schema&&(this.schema=b.schema),b.el&&(this.el=b.el),b.url&&(this.url=b.url),b.data&&this.populate(b.data));this.uri&&(this.collection.url=this.uri);if(!this.schema)return this.isInitalized=!1;this.isInitalized||(this.columns=this.schema.properties,this.collection.schema=this.schema,this.isInitalized=!0);return this.isInitalized},fetch:function(){this.collection.fetch()},populate:function(b){this.data=b;this.collection.reset(this.data)},
render:function(){if(this.el){var d=b.Utility.isString(this.el)?document.querySelector(this.el):this.el;d&&(this.template=this.compileTemplate(),d.innerHTML=this.template)}return this},compileTemplate:function(){var b=this.columns,p=this.data,f="<table>";if(b){var f=f+"<thead><tr>",n;for(n in b)b.hasOwnProperty(n)&&(f=f+"<th>"+n+"</th>");f+="</tr></thead>"}if(p){for(var f=f+"<tbody>",r,t,b=0;b<p.length;b++){n=p[b];f+="<tr>";for(r in n)n.hasOwnProperty(r)&&(t=n[r],f=f+"<td>"+t+"</td>");f+="</tr>"}f+=
"</tbody>"}return f+"</table>"},setURI:function(b){this.uri=b},setSchema:function(b){this.schema=b;this.columns=b.properties;this.collection.reset();this.collection.schema=b;this.uri&&(col.url=this.uri)}});b.Presentation.AutoTable=b.Presentation.AutomaticTable;return b.Presentation});
